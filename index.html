<html>
<head>
    <title>Chat with socket.io and node.js</title>
    <style>
    	#chat{
    		height: 400px;
    	}
        #contentWrap{
            display: none;
        }
        #chatWrap{
            float: left;
            border: 1px #000 solid;
        }
    </style>
</head>
<body>
    <div id="nameWrap">
        <p>Enter a username:</p>
        <p id="nameError"></p>
        <form id="setName">
            <input size="35" id="username" />
            <input type="submit" />
        </form>
    </div>

    <div id="contentWrap">
        <div id="chatWrap">
            <div id="chat"></div>
            <form id="send-message">
                <input size="35" id="message" />
                <input type="submit" />
            </form>
        </div>
        <div id="users"></div>
    </div>

    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/socket.io/socket.io.js"></script><!-- auto gen by socket.io -->
    <script>
    	jQuery(function($){ //short hand of document.ready
    		var socket = io.connect();

            var $nameForm = $('#setName');
            var $nameError = $('#nameError');
            var $nameBox = $('#username');

            var $users = $('#users');
    		var $messageForm = $('#send-message'); // cache static variables
    		var $messageBox = $('#message');
    		var $chat = $('#chat');

            $nameForm.submit(function(e){
                e.preventDefault();
                socket.emit('new user', $nameBox.val(), function(data){
                    //callback function
                    if(data) { //if valid username
                        $('#nameWrap').hide();
                        $('#contentWrap').show();
                    } else {
                        $nameError.html('That username is already taken! Try again.');
                    }
                });
                $nickBox.val('');
            });

            //display usernames
            socket.on('usernames', function(data){
                var html = '';
                for(i=0; i<data.length; i++){
                    html += data[i] + '<br/>';
                }
                $users.html(html);
            });

    		$messageForm.submit(function(e){
    			e.preventDefault();
    			socket.emit('send message', $messageBox.val()); //submit to server
    			$messageBox.val(''); //clear message box
    		});

    		socket.on('new message', function(data){
    			$chat.append('<b>' + data.name + ': </b>' + data.msg + "<br/>");
    		});

    	});
    </script>
</body>
</html>